From a38fe4c0ffe0cf0643b37e5520072e2f4674e687 Mon Sep 17 00:00:00 2001
From: Arvin Schnell <aschnell@suse.de>
Date: Mon, 3 Mar 2014 17:23:15 +0100
Subject: [PATCH] - fixed empty-pre-post cleanup algorithm

---
 client/cleanup.cc       |  2 ++
 client/commands.cc      | 13 +++++++++++++
 client/commands.h       |  4 ++++
 package/snapper.changes |  5 +++++
 4 files changed, 24 insertions(+)

diff --git a/client/cleanup.cc b/client/cleanup.cc
index 875fe79..cd48e70 100644
--- a/client/cleanup.cc
+++ b/client/cleanup.cc
@@ -362,6 +362,8 @@ do_cleanup_empty_pre_post(DBus::Connection& conn, const string& config_name)
 		    tmp.push_back(it1);
 		    tmp.push_back(it2);
 		}
+
+		command_delete_xcomparison(conn, config_name, it1->getNum(), it2->getNum());
 	    }
 	}
     }
diff --git a/client/commands.cc b/client/commands.cc
index 8123f30..d849cd4 100644
--- a/client/commands.cc
+++ b/client/commands.cc
@@ -294,6 +294,19 @@ command_create_xcomparison(DBus::Connection& conn, const string& config_name, un
 }
 
 
+void
+command_delete_xcomparison(DBus::Connection& conn, const string& config_name, unsigned int number1,
+			   unsigned int number2)
+{
+    DBus::MessageMethodCall call(SERVICE, OBJECT, INTERFACE, "DeleteComparison");
+
+    DBus::Hoho hoho(call);
+    hoho << config_name << number1 << number2;
+
+    conn.send_with_reply_and_block(call);
+}
+
+
 list<XFile>
 command_get_xfiles(DBus::Connection& conn, const string& config_name, unsigned int number1,
 		   unsigned int number2)
diff --git a/client/commands.h b/client/commands.h
index 51d1319..dfc29a6 100644
--- a/client/commands.h
+++ b/client/commands.h
@@ -95,6 +95,10 @@ void
 command_create_xcomparison(DBus::Connection& conn, const string& config_name, unsigned int number1,
 			   unsigned int number2);
 
+void
+command_delete_xcomparison(DBus::Connection& conn, const string& config_name, unsigned int number1,
+			   unsigned int number2);
+
 list<XFile>
 command_get_xfiles(DBus::Connection& conn, const string& config_name, unsigned int number1,
 		   unsigned int number2);
-- 
1.9.3

